name: Assign Random Reviewer

on:
  pull_request:
    types: [opened, reopened, ready_for_review]

permissions:
  contents: read
  pull-requests: write

jobs:
  assign:
    if: ${{ !github.event.pull_request.draft }} # Draft PRì€ ì œì™¸
    runs-on: ubuntu-latest
    steps:
      - name: Pick random reviewer (1 user)
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;
            const prNum = context.payload.pull_request.number;
            const author = context.payload.pull_request.user.login;

            const reviewers = ["csy10001","desembers","jihoLee0818","youngrae0317","HY-WG"];

            const deny = new Set([author, "dependabot[bot]", "github-actions[bot]"]);

            // ì´ë¯¸ ìš”ì²­ëœ ë¦¬ë·°ì–´/íŒ€ ì œì™¸
            const { data: pr } = await github.rest.pulls.get({ owner, repo, pull_number: prNum });
            const already = new Set([
              ...(pr.requested_reviewers || []).map(u => u.login),
              ...(pr.requested_teams || []).map(t => t.slug),
            ]);

            // í›„ë³´ í’€ í•„í„°ë§
            let candidates = reviewers.filter(u => !deny.has(u) && !already.has(u));
            if (candidates.length === 0) {
              core.info("No eligible candidates. Skipping.");
              return;
            }

            // ëœë¤ 1ëª…
            const pick = candidates[Math.floor(Math.random() * candidates.length)];

            // ë¦¬ë·°ì–´ ìš”ì²­
            await github.rest.pulls.requestReviewers({
              owner, repo, pull_number: prNum, reviewers: [pick]
            });

            core.notice(`ğŸ¯ Assigned reviewer: ${pick}`);
